using Shouldly;
using System;
using System.Linq;
using System.Threading.Tasks;
using Resume.ResumeSnapshots;
using Resume.EntityFrameworkCore;
using Xunit;

namespace Resume.ResumeSnapshots
{
    public class ResumeSnapshotRepositoryTests : ResumeEntityFrameworkCoreTestBase
    {
        private readonly IResumeSnapshotRepository _resumeSnapshotRepository;

        public ResumeSnapshotRepositoryTests()
        {
            _resumeSnapshotRepository = GetRequiredService<IResumeSnapshotRepository>();
        }

        [Fact]
        public async Task GetListAsync()
        {
            // Arrange
            await WithUnitOfWorkAsync(async () =>
            {
                // Act
                var result = await _resumeSnapshotRepository.GetListAsync(
                    userMainId: Guid.Parse("1cadb7f0-8788-47da-ae92-0b1bc000819c"),
                    resumeMainId: Guid.Parse("46d223ee-e548-498d-beff-ae42c12a55d0"),
                    companyMainId: Guid.Parse("f0a60665-2d80-4a6d-8e91-7abbae4099be"),
                    companyJobId: Guid.Parse("ebc006b6-06ec-42ee-a13e-a26c9f030c19"),
                    snapshot: "aef956077a9a4fbda6858897de8ae00da3e7ff1fae9945fb901532cad77d25c208c2cc1c7084456fb3062971d4242c5d2e2ba47190a04142998d87c5233d3bd611d6c2be0b88434b8b7ade7fcacf107439e21d42b5dc4b74a38e0ebd86d15703616340955a144fcaa55ead92446745db329bb25c5d854590baf076802ac438f4b3e3828439ba4f969d70548cc303f3a6d6e3f7b557824327b429d053f273a0562cf0051b56ea4e81af691408f181740d384e1524efdc467995ec86a0b92d9ddde3c60be5925c438990e97be37cefc987b6febf036b064dbba6f69029b99723c3f0a9c093e1db4b878134abb95a99a9aa276a7476ba5e4e1fb5c529603f59eb4726de4dab922b43a4a63bf0fb2a3c3cb5da3a5198da6444a48eccc1b2d29f5e0a22c90e5444124f0eb8c82b5c96968a9527e25e34499a444e82c0c009df57f8d89bbc6f4081014c008e05d0bfa42975824605c714704842b58bbce5a3fe2cb9688b631b7624a94af4af2429ce71e2549262c8cdc35fb34caa82a8e1d71fe85f90ad049dae6e9e42b7a39a4a943e170e9ef961f5d33875408b815f87311199d829f019d35451504364b931aab3e730ffefccaf52a542914d2ba55f5dc4c2d013ad9644a605c5f5462a97ae296ef562131343a7de9b1a56456e87d6bf7d733b0b67408718fa88354282956eb212faf1e911155da220eb544529ad542d6ff1375ec1e370b9ab7b7f4d4596847b21ef2d808a07f538a1bdd94e9ba37ef5b3d3d0cbe4ba9b579468e54ee18bcf918256f3cda9aae8184b30544c7a8402c2fce67f6133016c9751a86b488c83a26bd5486623de31aa0477218f4fa19f611e56bdf2dc45e7780f38d7694e7089687a1a541c18d62f095fd272654644b64ec8aa9ddc13322cc1e7c0f88a4bf5b14d26960e9428f49a3f295f3d534d5389127d79c99290fa81eabb6ec8224645a20a9b766b4141eebb31650fde384d129f32d555eb43e2c5a5db15da571d440694b30a126d2b8a416024638342864ec8850a673be26cfc1b75f3c78f12424d41b0009a4591a9a95f8c3022ace26546d98dc812c557d541d37b77d2802cee467f8074e42ce514172f419575735da845cbbce1e526663ba88759d98fbe79cb4519894adb8a8d37cd36f9e6bef704164edc810eb7eaf0fe3102e2760f2a1f8b4be2aa2d9b8528d13748e62470c766af4311bf55d4587e5889529f5ab70908974e8f9e8d2f8cc015059f0a03f0493c884da390298a05ba7f9ea3e49254ce3ee14fa7b9339dfb9e2988c70e3c20ef2f1a473e9ba1726f6be5e96abb92c10b1db34e13a2a7db82367ed1a89f63360c41c34be7a3a3542e1490eef90c0e2dfc708c44dda71b7bee2457bb87aec0845a9d5b4e8686ca09bac73869895fbd1816b9d14182ace5ec60a202f9f76aa876e1f6354a0a965727a3a454e10c622611761fbe440e87cd030cf04ab1c439816d7edbce433eb902756c2cf21c2c030f9236388c4c819b2ec9daf375d3d188233529c4b646a58ee3d5f1f3542b33f5b6bd91f77d4c159060d5849c038457016a52429b8e4b4a960399b57f971a7548dfd791d12a4c74bfa330d9214b3ebfce932d031ec04368891b6b87af42c2892c49f3db882e4f928be9073391c1551ed72b21f30a4b4dc79c6b6db5f83adbc83b65a070d62d41cc8c1da505f625fce81edf6b0d82d74342a3ae58c80c2c78cb1a0faa5147b044ea871eaa713c31510c7a778c0b4cdb4bafa769dac97103f27822d2aa4ca9b34407964ee03b57a1795c9a80db74f4d44fab8476ef85d4bd2a6ba965c3b08b794ccf888f86ce4e00bba09f54d1a073634bda9523710af87efffaa9b43203881c449db09444531a48495ee7d1663450534cfc8af25a8469049528a1d6fd21e843482f948e7a6582f498e19c7143e56ecd43a69bc0187f15e5e63dba8d5d5cb926450bb2f08ba1be966b3699782ae8beec47e9b6d174d4daf2a4b166b15c64b58a446b80a7a144e09b299ce0787ec8b531404ead04d0c1b59ec9046ff8cc0bab5f4df19170e8579a239fb924419a5bf3a8456581ef6b33cc6b1f9677fe98cba71c42f4b93ba73b87e70095436ac9b7154a4b7dab91d704715c39205f4cd5ab1699437e8506ca2a3558e2c9f44021cdc62141ccb0345e80440f5ae3005166c98e8c4743924e91a120d0efe7e477802a2e0c419390fce4deb641e77dd6431b576dc349cb8c5682608f0e89f570a3a773b0e043d1a97b5662b7b9d5a33853cfd9f017453d88650136604c74bc66e185c1ce2c41a183d4e9cc57aed0791522e6c6fd0b48819cb27da27614e87700b02645bf344ad1a35e9dfae5b93b7aa44ae3337e544788bf506a545a2dbff3879bf4a18f194d96978091a193b05ea2d27bd0d69726463ba1134eb937578812b12f461bcb11447fa7039b79bf1b1ea67c0374c8dcf145efa210c526ea00cf495493aafaf3e84ca0a2a1e37c2bcfabf50c1139362aa14863ae9052161f6340b9013099cf874a43f49e23a204c63fe24be35fb1ae645744068618fef0bb8f632ef9842db43cb84f86846079d9e2e649dab891726eeed143038e4f17b139d08de2b62649ceedca42218b6f9db78680bf55d8f9e3ac407b4c06baa1c0c9aa4be9febb88704d9bc341f1b6b85328c63327c6ae23df66deca453cab0485baea5aae1b097e994f97774ff3a813fb0016a47782dedde77ea627485191bfb3c3678f6becc7081d988cca463abf83f1980db202a5338e7acc29084114aa17f751ee5dfa410d0be67e074b474f9d5e76a38a66786cebf5395f3bd245bfbb2a8111062138e3",
                    userCompanyBindId: Guid.Parse("390e9f60-b989-494e-aaa3-ead78c54b6ff"),
                    extendedInformation: "da825fc848f54ecc8cc76d5730091e02a01a2b35a7124046be3143c47f7fcd9d243695c57e11475db94ad1b54de7d3fe5d3ef209adfe46febd2286b66a28cbe1f57c4d06cd824e049bca6e115c3bad736892bd6ce2074343b38bd030110376579cd086d8e5de485ea528134cf59ca9ca367758e6862449de9d988a2f4794a611c30d6aae6d244a1a878bca6661674e8f8dabd7e411434798bd5b08d5934cc82e834509194cbd4a12bc8e52eaeb2bc36f7acc2f40269d4bdfb6dd33755e4639923dc5189e76a54657b50a20b5d2d33f0411eb7f789b574c62bb2ab59df93ca9935911ddfdb5e8429eadfc4e10044f83ff43cea8b219d94efa9117",
                    note: "affb1021b4824b618689703569cdebf2373c29852edc4fa8b933d2388fd8636a9247b5b4763147a5907b73b090bca56a948306fe68de40a5a5610057da08db68da5cd7565af647609331600c802f275c341dbc86eb1148e7b171ee1ed428eb16d1114165098a47a6977260a7b04ce5a30f8aa0e8272e467e852bc5629a539489739bbcb28af244b69d2e36c7e20e8458e83fe0bce1a042d9bb4bf2278740660be61e082860174f5c86b6c47f2d0e91f91c3993b14517453a8a4ea526704a2c68ba65717bf6b04427a1d6a277a25af7518408eccaa73d46ca8ea93eae181fc70056ea16ad964949c880cacf9dd76d17e0bce531dd36274f23866c",
                    status: "a2484f22ef224f268c463853ba349066b889042cbbed429399"
                );

                // Assert
                result.Count.ShouldBe(1);
                result.FirstOrDefault().ShouldNotBe(null);
                result.First().Id.ShouldBe(Guid.Parse("93441a69-0f55-47cc-ac39-0d3237dec291"));
            });
        }

        [Fact]
        public async Task GetCountAsync()
        {
            // Arrange
            await WithUnitOfWorkAsync(async () =>
            {
                // Act
                var result = await _resumeSnapshotRepository.GetCountAsync(
                    userMainId: Guid.Parse("aaf8557e-84a8-427d-952e-775445ec29d9"),
                    resumeMainId: Guid.Parse("59917a7e-9cfc-4c51-9cca-0300b7fb0d17"),
                    companyMainId: Guid.Parse("5e04e8a4-05f8-4874-a537-aa12e09084d2"),
                    companyJobId: Guid.Parse("3dc12f2f-8268-4ba0-a494-6757ac69c0cb"),
                    snapshot: "7e8306d2aba049208c4a966cc7833df753d5b58bc784445b950ead73bb4e732bedd22868eb18453190a177a6cc02ecb9db78d65621ba45cd92e5f9c3a2b0dc371bfdf45b4c17456f88e626bf644b4148576cca6c835a42fba95a2a52cbd2194dc1ca4c379f8544ebb91778ccf3160bb41657c62767ea41b69dcdd41f47e3ad475278ca3a33e941caa6ffc620a36e243dfcffbe79c00748af9c597656e0288a44b67cd9c16bd74194adbc27e5c192b15df296c75b4dcc4e7bbb6404f23ac7413c43034a5540604331bea13050e66e1fae12403942066b400b8208e986b08ce3def93cee33de064da98f273dc7c1947f82b0205b78984a49b89c80d8eac2380782bc6d7379593440b392bbb85c0fdc1e0d39546c065543469e859f9a7864b6bd05faa149a5a8d54584a81aa7d7361dcd328b68f83b496c447cbbeb1993bcb7064c151d7c4b970c456db5f782b049d8e80747f9dc2f8a73485c9eff162793ff56f692506d3444c447b696e1f2040623a7931e781e34609541c6a95f5849d5dc3243002358fd3a424e4db3eb66b3dc71baaae3ce81bef43341f4b78db060ed6f3781afeb6e64d4c24354becb0cb7f12a982e4a20e377016241bd99f50e12c75895001e39659c897345c98a34096af99d89f973a32066deb54629a5f2b62b9fb6443ae014bd7f368742b4b2d26766a9f12fc626c43317be5c407cb72c77d46f2c43afca69e30435694a53baf247d6da2e0ee88b5ce6af831d4536b6c392b7b640f47702211fff17f843abaa8148599b8bae987b63f06b45e5446abfddada66b3c69c8a166af345f0649e7a4bb4be873141866629f0446ea6840cf9dc5694e77b2d2310058a69038b44e70b5dc9870176b12bab60541467f32446d83864d13765336e8e9608c43537246e4b57ee7612488dc3ac802edf65925482db75c19d61b2442d62762c7dea12846a9801bc94297c2a4f18c45f9489a524ac3a25ddda9f1ff32e10d14813a3f504adf9243b8f40ce1456e50a4c57e6a954ee689edf554f5595f874c50a3e4235640c5b025d0c5bbf619b9b098befc63b44be7ac4e27a7989920921c898ebcc8c34b6291760e1625eb5c50bee137e6825340aebbc45af7500ae852098f280f1f16460891b7bdab323b9b88ab73cc75c6d44ba9aaa16ab27bd2fe996b9c705615964a61b8df1b0f902264828348700a60e54a8cb2fa4c442ad36d64f569ed1176b44d2583d5667c6394435d7d5b4187686646d795b5a713bd07dfd56f9d45b019554a79b35859069132b4ffc8a1010d2fb643b4890bf03ec0de250224d0149c72ff4eb59e7522d79e437af26410a1b1557a49e2b57d3118c36f2e096c2b08c68e0d421785b518205ffd0846082fad210ce144578fbc5d2b31c7793fe7bb13df24cf4a21b25803fe6b0a172fcdd61d682d3a466c9f9ac72ea1a113c0bfd4049d966c438282887b5ce17de323fc7b9c946b644c1494c409dc87bcbc6fb72cd5561dc74bbdb1fd93d2179436311c28ed49e422499985360783a550bb1410742048bed84ef5927d9682a481442d9ff9c3fdc01d4987b715efe67b47040a70e17415f68d48e38d47d226fd7709a9be91ca6f115e4df2a1439df547cc5e88908f7fa3da474f28b9102d49dc3809b820d76552252748e48ce0571d87eec3675e62119ce9624fb0a6a3ae55da668ee4dba85a5d58d9435586b6082988fd2721edfef75a49b84898a5e90dd0a6f4a165d8ca342d07624c3da208d20794b7af4b701b5409809d46739435724561158cc7112a4ddc6d0c44f2be593232e8c59776071c07112f3b4422b900f3bf382887e8f41122a4e5a3405982ced7ba9a58c2ddddafbdb5670343748c4a291f75506f42fc56489af7df4ae5a879d3c3be3454afb80d59bad14b4ae39eff08f27e509c789622aac771e74d0797a45efc08b1614fa3dc1339b1bc4d809b88a3ca9cb4da956ec9298ec3614455bc7bf4ff38ffcae8ca20068ee9884a9cbc0cea8c2da6d27d14dfb51f4d1b40eaa68332116047ff6090f2be624dce4470a99d4e9206ce9a4965c5c56bcfdf43c9b9f6673193f6668f240144d2092c4510b0b9047b48c237219c21ca6e92d342f1b5777e8af03ea9b4dfc2b4ffaed3484ea469d84cc78f00550b0707e6f32e4f5a9ca1eca94dfa5bace4cf7d991dc24599943a65ce7df104e7dc09f9e2e84a49fba53960db7bdfae8e528b391bd47045eca9330391c580a481a6e28514c8b34033883a70013b22a478af92ff41809d4e3d84307f6cf645493bf1fc950d44254ed1b5cd515a9eb2bdafd672874f8456434bb1e48329927fab652b75eb563a734e7ebfcb984fe04c0187e3e91271fe174c24b03cfa0688f3fe1a495b05d4bda54f1fb392ef03c497349092ff7a43b37e46b4bc00e37a3cc3527029b35611146149108aab6c6fe41f7991442a8c0caa794257a9e2fb583d359b032dcbb8e2601e4be9a0b4472904c9ff9c7349c29e51ae46b58a10cb358e6c418213d2a2f1b99f4e329a75025a86dd9bc6a6e7eb468d88492b975e18646272f56adeaa6ad2147947fda3c0f2f527004a181ac3dd2b58ab49449433ce8620795ade26ded6f6ff29436f8550e2d0973e91d9db1f8d0111364d59a1419d9ddf19bb4f5545b6c5612a470d84aa9311b09e2d06d562dfd6c72c4e34adb5ecdc7e9d2119fe94738258094a1e85ff2a48ab001a0627827721a2034bc7aaaa571607c096105956a4661e3b456398eef7e46366adb93f107b50da2c4c61b42e8b6eb46c201e10deb25be021436e9c4240fb83f3fd5c8eb2e152852e4a998c2ff023a9f95825",
                    userCompanyBindId: Guid.Parse("c46f9557-32ad-46f9-8758-2abd3d221d27"),
                    extendedInformation: "1cf723c9da664c07828050e5161a4d2dda18d03c02c143079effb3c0235517c476e5c2ad79f54fc7986e9f2989094331fc8f84d703954eb3abe730aa2f3394229a670e8313214ed2a548ab2e86acd2740eee685c308a4369ad196403ac6230deca3a38caad984ba4a2457308196e4701ac126d755fca41d0bfd28c9fc01c61e95a31229fca6e4c0cb92e29d7c4b92b71976f0b72abdf4d4b8f993a1f6d20fef90f7d96f201184e7698992134e83532e67fb5b0fa1ea341f6959bce14c65b4c13c3a85eb85cb24ff5bb72624c793d5a0ded22e2e4aef149d28e10cb9ddb5f31e79b0415e1691145e68e0a2d735cb2c31b3e5c22705e2449989dcf",
                    note: "a56cc5b8062f4cc88d6061b51778a8f63e8ee35a0ef54be1863fd2845f378ede9efd18d46ce243b399f20a44714587bd3c1ec26b83f243d0aeb79f69ffcd73826ae77b118edd422aa3eec585a8756da9ad2d94b0c60542c2aa2286fb154f1228a493097b75794bb5b71f5c66ebd465b7b2d7d65ffa494cd292dc0ee6349062c169cfa5b359f34cefbbbef3dcf2ed45da4ac0938291564d90914b266bbf480cea43943090d2e043e7a1ed5c797c5c791c5050c15abe81424b8ef8e51bae7557013c0efbe151b54c11a67f2450cc11003dcbf3d2454a8347cb81d5e1d7a96131a603b1c0fc02d54657b0de56e666af7c30e000b4b237374896ad70",
                    status: "cbb1c95103724d4fb78969c9c9259990a890b88036d44dbd9f"
                );

                // Assert
                result.ShouldBe(1);
            });
        }
    }
}